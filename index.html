<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de Orçamento</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center py-10 px-4">

  <div class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-6 md:p-10">
    <h1 class="text-2xl md:text-3xl font-bold text-center text-blue-600 mb-6">Gerador de Orçamento</h1>

    <!-- Dados Cliente -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div>
        <label class="block font-medium mb-1">Cliente</label>
        <input type="text" id="cliente" placeholder="Nome do cliente"
               class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
       <div>
        <label class="block font-medium mb-1">Telefone</label>
        <input type="tel" id="Tel_cliente" placeholder="Telefone do cliente"
               class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div>
        <label class="block font-medium mb-1">Data</label>
        <input type="date" id="data"
               class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
    </div>

    <!-- Tabela de Itens -->
    <h2 class="text-lg font-semibold mb-3">Itens</h2>
    <div class="overflow-x-auto mb-4">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-200">
          <tr>
            <th class="text-left px-3 py-2 border">Descrição</th>
            <th class="text-center px-2 py-2 border">Qtd</th>
            <th class="text-right px-2 py-2 border">Preço Unit.</th>
            <th class="text-right px-2 py-2 border">Total</th>
            <th class="text-center px-2 py-2 border">Ação</th>
          </tr>
        </thead>
        <tbody id="itens-body" class="bg-white">
          <!-- Itens dinamicamente inseridos -->
        </tbody>
      </table>
    </div>

    <div class="mb-6">
      <button onclick="adicionarItem()"
              class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded shadow">
        + Adicionar Item
      </button>
    </div>

    <!-- Totais -->
    <div class="text-right space-y-1 text-sm md:text-base font-medium">
      <div>Total: R$ <span id="total-geral">0,00</span></div>
      <div class="text-green-600">À vista (10% desconto): R$ <span id="total-desconto">0,00</span></div>
    </div>

    <!-- Botão PDF -->
    <div class="mt-8 text-center">
      <button onclick="gerarPDF()"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded shadow">
        Gerar PDF
      </button>
    </div>
  </div>

  <script>
    // Define a data padrão
    window.onload = () => {
      const hoje = new Date();
      const iso = hoje.toISOString().slice(0, 10);
      document.getElementById('data').value = iso;
    };

    function formatarData(dataISO) {
      const data = new Date(dataISO);
      // Corrige fuso para GMT-3 (Brasil)
      const dataCorrigida = new Date(data.getTime() + (3 * 60 * 60 * 1000));
      const dia = String(dataCorrigida.getDate()).padStart(2, '0');
      const mes = String(dataCorrigida.getMonth() + 1).padStart(2, '0');
      const ano = dataCorrigida.getFullYear();
      return `${dia}-${mes}-${ano}`;
    }

    function adicionarItem() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border px-3 py-2"><input type="text" class="descricao w-full border px-2 py-1 rounded" placeholder="Descrição"></td>
        <td class="border px-2 py-2 text-center"><input type="number" class="quantidade w-16 text-center border rounded px-2 py-1" value="1" min="1" onchange="atualizarTotais()"></td>
        <td class="border px-2 py-2 text-right"><input type="number" class="preco w-24 text-right border rounded px-2 py-1" value="0.00" min="0" step="0.01" onchange="atualizarTotais()"></td>
        <td class="border px-2 py-2 text-right total">0,00</td>
        <td class="border px-2 py-2 text-center">
          <button onclick="removerItem(this)" class="text-red-500 hover:underline">Remover</button>
        </td>
      `;
      document.getElementById('itens-body').appendChild(tr);
      atualizarTotais();
    }

    function removerItem(btn) {
      btn.closest('tr').remove();
      atualizarTotais();
    }

    function atualizarTotais() {
      let totalGeral = 0;
      const linhas = document.querySelectorAll('#itens-body tr');

      linhas.forEach(linha => {
        const qtd = parseFloat(linha.querySelector('.quantidade').value) || 0;
        const preco = parseFloat(linha.querySelector('.preco').value) || 0;
        const total = qtd * preco;
        linha.querySelector('.total').innerText = total.toFixed(2).replace('.', ',');
        totalGeral += total;
      });

      document.getElementById('total-geral').innerText = totalGeral.toFixed(2).replace('.', ',');
      document.getElementById('total-desconto').innerText = (totalGeral * 0.9).toFixed(2).replace('.', ',');
    }

    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });

     const cliente = document.getElementById('cliente').value.trim();
        const telefone = document.getElementById('Tel_cliente').value.trim(); // <- adicionado
         const dataISO = document.getElementById('data').value;
          const dataFormatada = formatarData(dataISO);
      const linhas = document.querySelectorAll('#itens-body tr');

      if (!cliente) {
        alert('Preencha o nome do cliente.');
        return;
      }

      if (linhas.length === 0) {
        alert('Adicione pelo menos um item.');
        return;
      }

      // Valida itens (descrição e valores)
      for (let linha of linhas) {
        const desc = linha.querySelector('.descricao').value.trim();
        const qtd = parseFloat(linha.querySelector('.quantidade').value);
        const preco = parseFloat(linha.querySelector('.preco').value);

        if (!desc) {
          alert('A descrição do item não pode estar vazia.');
          return;
        }
        if (qtd <= 0 || isNaN(qtd)) {
          alert('A quantidade deve ser maior que zero.');
          return;
        }
        if (preco < 0 || isNaN(preco)) {
          alert('O preço unitário deve ser zero ou maior.');
          return;
        }
      }

      // Cabeçalho
      doc.setFontSize(20);
      doc.setTextColor(33, 150, 243);
      doc.text('ORÇAMENTO', 40, 50);
      doc.setDrawColor(33, 150, 243);
      doc.line(40, 55, 555, 55);

      doc.setFontSize(12);
      doc.setTextColor(0);
      doc.text(`Cliente: ${cliente}`, 40, 75);
      doc.text(`Telefone: ${telefone}`, 40, 90);
      doc.text(`Data: ${dataFormatada}`, 40, 105);

      // Tabela cabeçalho
      let y = 133;
      doc.setFontSize(11);
      doc.setFillColor(240, 240, 240);
      doc.rect(40, y, 515, 20, 'F');
      doc.setTextColor(0);
      doc.text('Descrição', 45, y + 14);
      doc.text('Qtd', 300, y + 14, { align: 'center' });
      doc.text('Unitário', 360, y + 14, { align: 'right' });
      doc.text('Total', 450, y + 14, { align: 'right' });
      y += 26;

      // Itens com zebra
      linhas.forEach((linha, idx) => {
        const desc = linha.querySelector('.descricao').value || '';
        const qtd = linha.querySelector('.quantidade').value;
        const preco = parseFloat(linha.querySelector('.preco').value).toFixed(2);
        const total = parseFloat(linha.querySelector('.total').innerText.replace(',', '.')).toFixed(2);

        if (idx % 2 === 0) doc.setFillColor(255, 255, 255);
        else doc.setFillColor(245, 245, 245);

        doc.rect(40, y - 12, 515, 20, 'F');
        doc.setTextColor(0);
        doc.text(desc, 45, y);
        doc.text(qtd.toString(), 300, y, { align: 'center' });
        doc.text(`R$ ${preco.replace('.', ',')}`, 360, y, { align: 'right' });
        doc.text(`R$ ${total.replace('.', ',')}`, 450, y, { align: 'right' });
        y += 22;

        if (y > 750) {
          doc.addPage();
          y = 50;
        }
      });

      // Totais
      const totalGeral = parseFloat(document.getElementById('total-geral').innerText.replace(',', '.'));
      const totalComDesconto = totalGeral * 0.9;
      y += 20;

      doc.setFontSize(12);
      doc.text(`Total: R$ ${totalGeral.toFixed(2).replace('.', ',')}`, 40, y);
      y += 18;
      doc.setTextColor(34, 139, 34);
      doc.text(` Pagamento à vista (10% desconto): R$ ${totalComDesconto.toFixed(2).replace('.', ',')}`, 40, y);

      // Observações
      y += 30;
      doc.setFontSize(10);
      doc.setTextColor(100);
      doc.text('Observações:', 40, y);
      y += 12;
      doc.text('• Orçamento com validade de 15 dias. Após esse prazo, será necessário gerar um novo orçamento.', 40, y);

      // Assinatura fake
      y += 60;
      doc.setDrawColor(0);
      doc.line(40, y, 250, y); // linha assinatura
      y += 15;
      doc.setFontSize(11);
      doc.setTextColor(0);
      doc.text('Gabriel A. Santos - (12) 98101-0964', 40, y);
      doc.setFontSize(9);
      doc.setTextColor(90);
      doc.text('Responsável Técnico', 40, y + 12);

      doc.save(`orcamento_${cliente.replace(/\s+/g, '_').toLowerCase()}.pdf`);
    }
  </script>
</body>
</html>





